!function(){var e;try{var t=null;function Ke(e){return Ke=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Ke(e)}function Ye(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(Ye=function(){return!!e})()}function $e(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ge(e){return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e}function Qe(e,t){return!t||"object"!==Ge(t)&&"function"!=typeof t?$e(e):t}function Ze(e,t,n){return t=Ke(t),Qe(e,Ye()?Reflect.construct(t,n||[],Ke(e).constructor):t.apply(e,n))}function et(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function tt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function nt(e,t,n){return t&&tt(e.prototype,t),n&&tt(e,n),e}function rt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ot(e,t){return ot=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},ot(e,t)}function it(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ot(e,t)}function at(e,t,n){return at=Ye()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var o=new(Function.bind.apply(e,r));return n&&ot(o,n.prototype),o},at.apply(null,arguments)}function ct(e){var n="function"==typeof t?new t:void 0;return ct=function(e){if(null===e||(t=e,-1===Function.toString.call(t).indexOf("[native code]")))return e;var t;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==n){if(n.has(e))return n.get(e);n.set(e,r)}function r(){return at(e,arguments,Ke(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),ot(r,e)},ct(e)}var n=window.encodeURIComponent;function ut(e){return e}function st(){return Math.random().toString(36).slice(2)}var r,o=ut("241205-154253-805"),i=ut("wwopendata.web"),a=ut("465a646d1123c2d4fc2134f33f3cc9e6e59c0a67263d54bd32a5ddf5524bc034"),c=ut("j8KRCF9pZgmSvtM7x/0bMk6kYUL+HU2/YqL54B3zPhoAuVdVA1AIpDGMk1MzapgW9EYQcLe8Lx15/g/zoKb7/Q7mirs6iH6nsRoS1saUtoLy4uEdfNAHSb0ZkOWdQqu+"),u=ut("m4o8vp0s.cQ6Zf4k2oAbu_cfIbzxevKgr6TN0lBVq2Sqzp_yIxLPQ"),s=ut("".concat(i,"@").concat(o)),l=location.origin||"".concat(location.protocol,"//").concat(location.host),f="https://open.work.weixin.qq.com",d="".concat(f,"/wwopen/openData/frame/index#origin=").concat(n(l)),p="bRLDot6R4Kymzz0jPO",v="https://aegis.qq.com/collect",h=2,g=4,w=[],y=u;function lt(e){w.unshift({level:h,msg:e})}function ft(e){w.unshift({level:h,msg:e}),pt()}function dt(e){w.unshift({level:g,msg:e}),pt()}function pt(){r||(r=setTimeout(vt,10))}function vt(){r=void 0,0!==w.length&&(ht("".concat(v,"?id=").concat(p)+"&from=".concat(l)+"&sessionId=".concat(n(y))+"&version=".concat(n(s)),w.reverse()),w=[])}function ht(e,t){var r=new XMLHttpRequest;"withCredentials"in r||(r=new XDomainRequest);for(var o=[],i=t.length,a=0;a<i;a++)o.push(["msg[".concat(a,"]=").concat(n(t[a].msg)),"level[".concat(a,"]=").concat(t[a].level)].join("&"));o.push("count=".concat(i)),r.open("POST",e),r.setRequestHeader("Content-type","application/x-www-form-urlencoded"),r.send(o.join("&"))}var m={};function gt(e,t){wt(e,(function e(n){yt("name",e),t(n)}))}function wt(e,t){bt(m,e)||(m[e]=[]),m[e].push(t)}function yt(e,t){if(bt(m,e)){var n=m[e],r=n.indexOf(t);r>=0&&n.splice(r,1)}}function mt(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(bt(m,e))if(n){var r={type:e,detail:t};m[e].forEach((function(t){try{t(r)}catch(t){console.log("[event] ".concat(e," error: ").concat(t))}}))}else mt(e,t,!0)}function bt(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function Ot(e,t){return function(){for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];try{return t.apply(this,r)}catch(t){Et(t,e),mt("error",t)}}}e={captureException:Et};var b=At(lt),O=At(ft),S=At(dt);function St(e){lt(e),vt()}function Et(e,t){dt("[".concat(t,"] ").concat(_t(e)))}function At(e){return function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(var o=[],i=0,a=n.length;i<a;i++)o.push(Ct(n[i]));e(o.join(" "))}}function Ct(e){return e?"object"!==(void 0===e?"undefined":Ge(e))?e:"string"==typeof e.stack?_t(e):JSON.stringify(e):e}function _t(e){return"".concat(e," ").concat(e.stack)}var E=Object.freeze({__proto__:null,captureException:Et,captureMessage:St,error:S,log:b,warn:O,wrap:Ot});function jt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function kt(e){if(Array.isArray(e))return jt(e)}function xt(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function Mt(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Dt(e,t){if(e){if("string"==typeof e)return jt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?jt(e,t):void 0}}function Tt(e){return kt(e)||xt(e)||Dt(e)||Mt()}var A="[ww-open-data]";function Wt(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n]}function Ft(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r;(r=E).log.apply(r,Tt(t))}function Pt(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r;(r=E).warn.apply(r,Tt(t))}function Rt(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r;(r=E).error.apply(r,Tt(t))}function Nt(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r,o;(r=console).error.apply(r,[A].concat(Tt(t))),(o=E).error.apply(o,Tt(t))}var C=Function.prototype.call;function It(){var e={Math:window.Math,Number:window.Number,JSON:window.JSON,Promise:window.Promise,Uint8Array:window.Uint8Array,Function:window.Function,Object:window.Object,Array:window.Array,String:window.String,WeakMap:window.WeakMap,Element:window.Element,ShadowRoot:window.ShadowRoot,Image:window.Image,Node:window.Node,EventTarget:window.EventTarget,HTMLIFrameElement:window.HTMLIFrameElement,CanvasRenderingContext2D:window.CanvasRenderingContext2D},t={fetch:window.fetch,parseInt:window.parseInt,setTimeout:window.setTimeout},n=Object.create(null);return Lt(n,"protected",Object.create(null)),Lt(n,"singleton",Object.create(null)),Object.keys(e).forEach((function(t){e[t]&&(Lt(n.singleton,t,e[t]),Lt(n.protected,t,qt(e[t])),e[t].prototype&&(Lt(n.protected[t],"prototype",qt(e[t].prototype)),Object.freeze(n.protected[t].prototype)),Object.freeze(n.protected[t]))})),Object.keys(t).forEach((function(e){Lt(n.singleton,e,t[e])})),Lt(n.singleton,"call",C.bind(C)),Object.defineProperty(n,"__version__",{value:s}),Object.freeze(n.protected),Object.freeze(n.singleton),Object.freeze(n),n}function qt(e){var t=Object.create(null);return Object.getOwnPropertyNames(e).forEach((function(n){if("prototype"!==n){var r=Object.getOwnPropertyDescriptor(e,n),o=Object.create(null);Lt(o,"value",r.value),Lt(o,"get",r.get),Lt(o,"set",r.set),Lt(t,n,Object.freeze(o))}})),t}function Lt(e,t,n){Object.defineProperty(e,t,{value:n,enumerable:!0})}var _=It(),j=null==_?void 0:_.protected,k=null==_?void 0:_.singleton,x=(null==k?void 0:k.call)||Function.prototype.call.bind(Function.prototype.call),M=Ut(j,"Function.prototype.bind"),D=Ut(j,"Function.prototype.call"),T=function(e){return e&&x(M,D,e)};Ut(j,"Object.keys");var W=Ut(j,"Object.defineProperty"),F=Ut(k,"setTimeout","direct"),P=T(Ut(j,"Object.prototype.hasOwnProperty")),R=T(Ut(j,"Array.prototype.push")),N=T(Ut(j,"Array.prototype.forEach")),I=T(Ut(j,"Array.prototype.slice"));T(Ut(j,"Math.random")),T(Ut(j,"Number.prototype.toString"));var q=T(Ut(j,"String.prototype.indexOf")),L=T(Ut(j,"String.prototype.slice")),U=Ut(k,"Image","direct"),z=T(Ut(j,"Image.prototype.src","set"))||T(Ut(j,"HTMLImageElement.prototype.src","set"))||function(e,t){e.src=t},H=T(Ut(j,"HTMLIframeElement.prototype.contentWindow","get"))||function(e){return e.contentWindow},J=T(Ut(j,"HTMLIframeElement.prototype.contentDocument","get"))||function(e){return e.contentDocument},B=T(Ut(j,"EventTarget.prototype.addEventListener"))||function(e,t,n){e.addEventListener(t,n)},V=T(Ut(j,"CanvasRenderingContext2D.prototype.fillText")),X=T(Ut(j,"CanvasRenderingContext2D.prototype.drawImage")),K=T(Ut(j,"CanvasRenderingContext2D.prototype.strokeText")),Y=T(Ut(j,"CanvasRenderingContext2D.prototype.measureText")),$=Ut(k,"WeakMap","direct"),G=T(Ut(j,"WeakMap.prototype.get")),Q=T(Ut(j,"WeakMap.prototype.set")),Z=T(Ut(j,"Element.prototype.attachShadow")),ee=T(Ut(j,"Node.prototype.textContent","set"));function Ut(e,t){var n,r,o,i,a,c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"value",u=(null==j||null===(n=j.String)||void 0===n?void 0:n.prototype.split.value)||window.String.prototype.split,s=(null==j||null===(r=j.Array)||void 0===r?void 0:r.prototype.pop.value)||window.Array.prototype.pop,l=(null==j||null===(o=j.Array)||void 0===o?void 0:o.prototype.forEach.value)||window.Array.prototype.forEach,f=(null==j||null===(i=j.Object)||void 0===i?void 0:i.getOwnPropertyDescriptor.value)||Object.getOwnPropertyDescriptor,d=x(u,t,"."),p=x(s,d),v=e,h=window;if(x(l,d,(function(e){v&&(v=v[e]),h&&(h=h[e])})),null==v?void 0:v[p]){if(v=v[p],"direct"===c)return v;if(v[c])return v[c]}if(h)return"direct"===c||"value"===c?h[p]:null===(a=f(h,p))||void 0===a?void 0:a[c]}var te=new U,ne=!1,re=null,oe=[];function zt(e){ne?e():re?e(re):oe.push(e)}function Ht(){var e=oe;oe=[],N(e,(function(e){e(re)}))}function Jt(e,t){if(P(e,t))return e[t]}function Bt(e,t,n){W(e,t,{value:n,writable:!0,enumerable:!0,configurable:!0})}B(te,"load",(function(){ne=!0,F(Ht,1)})),B(te,"error",(function(){re=new Error("Failed to load crossorigin image"),F(Ht,1)})),z(te,"https://wwcdn.weixin.qq.com/node/wework/images/1x1-00000000.91e42db1c6.png");var ie="\ufeff",ae=String.fromCharCode(8204),ce=String.fromCharCode(8205),ue=String.fromCharCode(8203),se=[String.fromCharCode(8206),String.fromCharCode(8207),ae,ce,ue],le={},fe=0;function Vt(e){var t=Jt(e,"encrypt_token");if(t)return t;var n=Jt(e,"data"),r=Jt(e,"encrypt_text_data");if(n&&r){for(var o=(fe++).toString(5),i="",a=0,c=o.length;a<c;a++)i+=se[Number(o[a])];var u=ie+r+i+ie;return Bt(le,u,n),Bt(e,"encrypt_token",u),u}}function Xt(e){var t=q(e,ie,0);if(-1===t)return e;for(var n=L(e,0,t);-1!==t;){var r=q(e,ie,t+1);if(-1===r)break;var o=Jt(le,L(e,t,r+1));o?(n+=o,t=r+1):(n+=L(e,t,r),t=r)}return n+L(e,t)}var de=$&&new $,pe=!1,ve=!1;function Kt(){var e;if(pe)return!0;var t=null===(e=window.CanvasRenderingContext2D)||void 0===e?void 0:e.prototype;return!!t&&(t.strokeText=function(e,t,n,r){if(!ne)return null==r?K(this,e,t,n):K(this,e,t,n,r);var o=Xt(e);return o!==e&&Gt(this),null==r?K(this,o,t,n):K(this,o,t,n,r)},t.fillText=function(e,t,n,r){if(!ne)return null==r?V(this,e,t,n):V(this,e,t,n,r);var o=Xt(e);return o!==e&&Gt(this),null==r?V(this,o,t,n):V(this,o,t,n,r)},t.measureText=function(e){return Y(this,ne?Xt(e):e)},pe=!0,!0)}function Yt(){Pt("enable canvas sharing"),ve=!0}function $t(){ve=!1}function Gt(e){G(de,e)||(ve||X(e,te,0,0),Q(de,e,!0))}var he={};function Qt(e,t,n){return"".concat(e,"::").concat(t,"::").concat(n||"")}function Zt(e){return Qt(Jt(e,"type"),Jt(e,"id"),Jt(e,"corpid"))}function en(e){return Jt(he,e)}var ge=st(),we=1,ye={},me={},be={};function tn(e,t){var n="".concat(ge,".").concat(we++),r=[],o={},i=0;if(N(e,(function(e){var t=Jt(e,"type"),a=Jt(e,"id");if(t&&a){var c=Qt(t,a,Jt(e,"corpid"));en(c)||P(o,c)||(Bt(o,c,!0),i+=1,P(ye,c)?R(Jt(ye,c),n):(Bt(ye,c,[n]),R(r,e)))}})),i)return Bt(be,n,i),Bt(me,n,t),r;t()}function nn(e,t){if(!e)return Rt("[callback] missing response"),void rn(t,new Error("missing response data"));var n=Jt(e,"items");if(!n)return Rt("[callback] missing items"),void rn(t,new Error("missing response items"));N(n,(function(e){var t;t=Zt(e),Bt(he,t,e)}));var r=[];N(t,(function(e){var t=Zt(e);if(en(t)){var n=Jt(ye,t);n&&(delete ye[t],N(n,(function(e){var t=Jt(me,e);if(t){var n=Jt(be,e)-1;n>0?Bt(be,e,n):(delete be[e],delete me[e],t())}})))}else R(r,e)})),r.length>0&&rn(r,new Error("missing items"))}function rn(e,t){N(e,(function(e){var n=Zt(e),r=Jt(ye,n);r&&(delete ye[n],N(r,(function(e){var n=Jt(me,e);delete be[e],delete me[e],n&&n(t)})))}))}function on(e){for(var t=Ut(j,"JSON.parse"),n=Ut(k,"Uint8Array","direct"),r=Ut(j,"String.fromCodePoint"),o=r,i=new n(e),a="",c=0,u=i.length;c<u;){var s=i[c++];if(s<=127)a+=o(s);else{var l=63&i[c++];if(s<=223)a+=o((31&s)<<6|l);else{var f=63&i[c++];if(s<=239)a+=o((15&s)<<12|l<<6|f);else{var d=63&i[c++];r?a+=o((7&s)<<18|l<<12|f<<6|d):(a+=o(63),c+=3)}}}}return t(a)}function an(e){for(var t=Ut(k,"Uint8Array","direct"),n=Ut(k,"parseInt","direct"),r=T(Ut(j,"String.prototype.substring")),o=new t(e.length/2),i=0,a=e.length;i<a;i+=2)o[i/2]=n(r(e,i,i+2),16);return o}var Oe,Se,Ee,Ae={skey:null},Ce=(null===(Oe=window.crypto)||void 0===Oe?void 0:Oe.subtle)||(null===(Se=window.crypto)||void 0===Se?void 0:Se.webkitSubtle);function cn(e,t,n,r){sn(e,t,n,r,!0)}function un(e,t,n,r){sn(e,t,n,r,!1)}function sn(e,t,n,r){var o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(window.fetch)window.fetch(e,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then((function(e){if(200===e.status)return o?e.arrayBuffer():e.json();var t="Invalid response status ".concat(e.status);return e.json().catch((function(){throw new Error(t)})).then((function(e){throw(null==e?void 0:e.result)?null==e?void 0:e.result:new Error(t)}))})).then(n,r);else{var i=new XMLHttpRequest;i.open("POST",e),i.withCredentials=!0,o&&(i.responseType="arraybuffer"),i.setRequestHeader("Content-Type","application/json"),i.onreadystatechange=function(){if(i.readyState===XMLHttpRequest.DONE)if(200===i.status)if(o)n(i.response);else try{n(JSON.parse(i.responseText))}catch(e){r(new Error("Parse response error"))}else r(new Error("Invalid response status ".concat(i.status)))},i.onerror=function(){r(new Error("Request error"))},i.send(JSON.stringify(t))}}function ln(e){if(!a)return Rt("[fetchData] missing referer"),void rn(e,{errMsg:"wwapp.fetchOpenData:fail",hint:"Missing referer for jwxwork.js. See: https://developer.work.weixin.qq.com/document/path/91958"});var t=st(),n="".concat(f,"/wwopen/openData/getOpenData?f=json&r=").concat(t);Ft("[fetchData] begin #".concat(t));var r=Ee||(Ee=Ce.importKey("raw",an(a),"AES-CBC",!1,["decrypt"]));function o(n){Rt("[fetchData] fetch fail #".concat(t," (").concat(t,")"),n),rn(e,{errMsg:"wwapp.fetchOpenData:fail",rand:t,detail:n})}cn(n,{items:e,skey:Ae.skey,sid:c},(function(n){Ft("[fetchData] fetch res #".concat(t)),r.then((function(e){return Ce.decrypt({name:"AES-CBC",iv:new Uint8Array(16)},e,n)})).then(on).then((function(n){Ft("[fetchData] fetch parsed #".concat(t)),nn(n,e)})).catch(o)}),o)}function fn(e,t,n){var r=null;try{r=J(e)}catch(e){}if(null!==r)throw new Error("Missing cross origin");Wt("[iframe] postMessage",e,t,n),H(e).postMessage(t,n)}var _e={},je=st(),ke=0;function dn(e){var t="".concat(je,".").concat(st(),".").concat(ke++);return Bt(_e,t,e),t}function pn(e){delete _e[e]}st();var xe,Me=1e3,De=20,Te=[];function vn(e,t){var n=tn(e,t);n&&(N(n,(function(e){R(Te,e)})),!xe&&Te.length&&(xe=F(Ot("flush-fetch",hn),De)))}function hn(){var e=Te;xe=void 0,Te=[];for(var t=e.length,n=0;n<t;n+=Me){ln(I(e,n,n+Me))}}var We=function(){function e(){var t=this;et(this,e),rt(this,"iframe",document.createElement("iframe")),rt(this,"state",1),rt(this,"queue",[]),rt(this,"timer",void 0),this.iframe.onload=Ot("MainFrame.onload",(function(){Ft("[MainFrame] onload"),t.state=2,t.fetchData()})),this.iframe.onerror=function(e){Et((null==e?void 0:e.error)||new Error("MainFrame load error"),"MainFrame.onerror"),t.state=3},this.iframe.style.display="none",this.iframe.referrerPolicy="origin",this.iframe.src=d}return nt(e,[{key:"enqueueFetch",value:function(e){var t=this;this.queue.push(e),this.timer||(this.timer=F(Ot("MainFrame.timeout",(function(){2===t.state&&t.fetchData()})),20))}},{key:"fetchData",value:function(){var e={},t=[];this.queue.forEach((function(n){var r="".concat(n.type,"::").concat(n.id,"::").concat(n.corpid||"");e[r]||(e[r]=!0,t.push(n))})),t.length&&(this.timer=void 0,this.queue=[],Ft("[MainFrame] fetchData"),fn(this.iframe,JSON.stringify({type:"fetch",items:t,skey:Ae.skey,sid:c}),f))}}]),e}(),Fe=["fontFamily","fontSize","fontWeight","fontStyle","fontVariant","fontStretch","fontSizeAdjust","color","cursor"],Pe=function(){function e(t,n){et(this,e),rt(this,"container",void 0),rt(this,"mainFrame",void 0),rt(this,"renderType",void 0),rt(this,"loadState",void 0),rt(this,"renderEl",void 0),this.container=t,this.mainFrame=n,this.renderType=1,this.loadState=1}return nt(e,[{key:"update",value:function(){var e=this.getItem();if(!e.type||!e.id)return this.renderEmpty();this.renderText(e)}},{key:"renderEmpty",value:function(){this.setChild(1)}},{key:"renderText",value:function(e){var t=this;if(2!==this.renderType||3===this.loadState){var r=document.createElement("iframe");r.onload=Ot("Frame.onload",(function(){t.renderEl===r&&(t.loadState=2,t.notifyUpdate())})),r.onerror=function(e){t.renderEl===r&&(Et((null==e?void 0:e.error)||new Error("Frame load error"),"Frame.onerror"),t.loadState=3)};var o=n("".concat(e.type,"::").concat(e.id,"::").concat(e.corpid||""));r.frameBorder="0",r.referrerPolicy="origin",r.src="".concat(d,"&init=").concat(o),this.loadState=4,this.setChild(2,r)}this.mainFrame.enqueueFetch(e),2===this.loadState&&this.notifyUpdate(e)}},{key:"setChild",value:function(e,t){for(var n=this.container;n.firstChild;)n.removeChild(n.firstChild);t&&n.appendChild(t),this.renderEl=t,this.renderType=e}},{key:"getItem",value:function(){return{type:this.container.getAttribute("type"),id:this.container.getAttribute("openid"),corpid:this.container.getAttribute("corpid")||void 0}}},{key:"notifyUpdate",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getItem();if(e.type&&e.id){var t={},n=getComputedStyle(this.container);Fe.forEach((function(e){t[e]=n[e]})),fn(this.renderEl,JSON.stringify({type:"update",item:e,style:t}),f)}}}]),e}(),Re={"ww.opendata.event":function(e,t){var n;"click"===e.eventType&&(null===(n=t.parentNode)||void 0===n||n.click())},"ww.opendata.resize":function(e,t){var n=e.size;t.style.width=n.width,t.style.height=n.height,mt("update",{el:t.parentNode,hasData:!!n.width})}};function gn(e){if(e.origin===f){var t;try{t=JSON.parse(e.data)}catch(e){}t&&Re[t.type]&&N(document.querySelectorAll("ww-open-data iframe"),(function(n){n.contentWindow===e.source&&Re[t.type](t,n)}))}}var Ne,Ie,qe="__WW_OPENDATA_RENDER__";function wn(){window.addEventListener?window.addEventListener("message",Ot("dispatchMessage",gn)):window.attachEvent("onmessage",Ot("dispatchMessage",gn));var e=document.querySelector("head");Ie=document.createElement("style"),e.appendChild(Ie),Ne=new We,e.appendChild(Ne.iframe);var t=Ie.sheet;t.insertRule("ww-open-data { display: inline-block; vertical-align: text-bottom; overflow: hidden }",0),t.insertRule("ww-open-data img { display: block; width: 100%; height: 100% }",1),t.insertRule("ww-open-data iframe { display: block; width: 0; height: 0 }",2)}function yn(e){if(e){var t=e;t[qe]||(t[qe]=new Pe(e,Ne)),t[qe].update()}}function mn(e){N(e,yn)}var Le=$&&new $;function bn(e){var t=G(Le,e);if(t)return t;try{var n=Z(e,{mode:"closed"});return Q(Le,e,n),n}catch(t){Rt("[getShadow] fail",e,t)}}function On(e){Wt("[bindAll] begin",e),N(e,Sn),Wt("[bindAll] end")}function Sn(e){if(!En(e,!0)){Ae.skey||(mt("error",{errMsg:"bind:fail",message:"missing agentConfig",element:e}),console.error("[ww-open-data] 页面未完成 wx.agentConfig，请先完成 wx.agentConfig 再调用 WWOpenData.bind，后续将逐步下线未完成 wx.agentConfig 时调用 WWOpenData.bind 的支持"));var t=st();vn([{type:e.getAttribute("type"),id:e.getAttribute("openid"),corpid:e.getAttribute("corpid")}],Ot("bind-pending",(function(n){if(n)return Rt("[bind] fetch error",t,n),void mt("error",{errMsg:"bind:fail",message:"fetch open-data fail",detail:n});En(e)})))}}function En(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!(null==e?void 0:e.getAttribute))return mt("error",{errMsg:"bind:fail",message:"missing bind element",element:e}),!1;var n=e.getAttribute("type");if(!n)return mt("error",{errMsg:"bind:fail",message:"missing open-data type",element:e}),!1;var r=e.getAttribute("openid");if(!r)return mt("error",{errMsg:"bind:fail",message:"missing open-data openid",element:e}),!1;var o=e.getAttribute("corpid"),i=bn(e);if(!i)return mt("error",{errMsg:"bind:fail",message:"attach shadow fail",element:e}),!1;var a=en(Qt(n,r,o));if(!a)return t||mt("error",{errMsg:"bind:fail",message:"missing open-data item",element:e}),!1;var c=Jt(a,"data");return ee(i,c||""),mt("update",{element:e,hasData:!!c}),!!c}var Ue=0;Z||(Ue|=1),Ce||(Ue|=2),"http:"===document.location.protocol&&(Ue|=4);var ze,He=0,Je=navigator.userAgent;if(!(/miniProgram/i.test(Je)||"miniprogram"===window.__wxjs_environment))/wxwork/i.test(Je)&&(He|=4),window.WeixinSandBox&&(He|=1),(null===(ze=window.wx)||void 0===ze?void 0:ze.agentConfig)&&(He|=2);var Be=Ot("bind",Ue?yn:Sn),Ve=Ot("bindAll",Ue?mn:On);function An(){_n("checkSession",{sid:c},arguments.length>0&&void 0!==arguments[0]?arguments[0]:{})}function Cn(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!(e.corpid&&e.agentid&&e.timestamp&&e.nonceStr&&e.signature&&e.jsApiList)){var t,n,r={err_Info:"fail",errMsg:"agentConfig:fail",hint:"Missing params"};return null===(t=e.fail)||void 0===t||t.call(e,r),void(null===(n=e.complete)||void 0===n||n.call(e,r))}var o={corpid:"".concat(e.corpid),agentid:"".concat(e.agentid),timestamp:"".concat(e.timestamp),nonceStr:"".concat(e.nonceStr),signature:"".concat(e.signature),jsApiList:e.jsApiList,url:location.href};_n("agentConfig",{config:o,sid:c},e,(function(e){var t,n;Ae.skey&&(null===(t=e.data)||void 0===t?void 0:t.skey)!==Ae.skey&&(he={}),Ae.skey=null===(n=e.data)||void 0===n?void 0:n.skey,Ve(document.querySelectorAll("ww-open-data")),Ft("[user config] #".concat(JSON.stringify(o)))}))}function _n(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3?arguments[3]:void 0,o=st();Ft("[invoke] ".concat(e," begin #").concat(o)),un("".concat(f,"/wwopen/openData/").concat(e,"?f=json&r=").concat(o),t,(function(t){var i,a,c,u,s=(null===(i=t.data)||void 0===i?void 0:i.result)||t.data||{errMsg:"".concat(e,":fail")};s.errMsg==="".concat(e,":ok")?(Wt("[invoke] ".concat(e," succ #").concat(o)),null==r||r(t),null===(c=n.success)||void 0===c||c.call(n,s)):(Rt("[invoke] ".concat(e," fail #").concat(o),t),null===(u=n.fail)||void 0===u||u.call(n,s));null===(a=n.complete)||void 0===a||a.call(n,s)}),(function(t){var r,i;Rt("[invoke] ".concat(e," fail #").concat(o),t);var a={errMsg:"".concat(e,":fail")};null===(r=n.fail)||void 0===r||r.call(n,a),null===(i=n.complete)||void 0===i||i.call(n,a)}))}function jn(e,t){var n=e.items;vn(n,(function(e){if(e)return t(e);var r=[];N(n,(function(e){var t=en(Zt(e));t&&1===Jt(t,"datakind")&&r.push({type:e.type,id:e.id,corpid:e.corpid,data:Vt(t)})})),zt((function(e){e?t(e):t(null,{items:r})}))}))}function kn(e,t){t(null,(function(e){xn(e)}))}function xn(e,t){fn(e,{type:"ww-open-data:inject-session",data:t},arguments.length>2&&void 0!==arguments[2]?arguments[2]:"*")}if(He)Pt("skip inject",He);else{if(Ue?(Pt("inject iframe",Ue),wn()):Ft("inject begin",Ue),a||Nt("Missing referer for jwxwork.js. See: https://work.weixin.qq.com/api/doc/90001/90143/91958"),window.wx?window.wx.agentConfig||Ft("define wx.agentConfig"):Pt("missing window.wx"),window.wx||(window.wx={}),window.wx.agentConfig||W(window.wx,"agentConfig",{value:Ot("agentConfig",Cn)}),window.WWOpenData)Rt("window.WWOpenData already exists");else{var Xe={};Mn(Xe,"bindAll",Ve),Mn(Xe,"bind",Be),Mn(Xe,"on",wt),Mn(Xe,"once",gt),Mn(Xe,"off",yt),Mn(Xe,"checkSession",An),Mn(Xe,"initCanvas",Kt),Mn(Xe,"enableCanvasSharing",Yt),Mn(Xe,"disableCanvasSharing",$t),Mn(Xe,"prefetch",jn),Mn(Xe,"registerOpenFrame",Ot("registerOpenFrame",dn)),Mn(Xe,"unregisterOpenFrame",Ot("unregisterOpenFrame",pn)),Mn(Xe,"createOpenSessionInjector",Ot("createOpenSessionInjector",kn)),W(Xe,"__version__",{value:s}),Mn(Xe,"agentConfig",Ot("agentConfig",Cn)),Mn(window,"WWOpenData",Xe),Ft("window.WWOpenData defined",window.WWOpenData)}"customElements"in window&&!customElements.get("ww-open-data")&&Dn()}function Mn(e,t,n){W(e,t,{value:n,enumerable:!0})}function Dn(){try{Ft("register custom element");var e=function(e){e._current={type:e.getAttribute("type"),id:e.getAttribute("openid"),corpid:e.getAttribute("corpid")},e._current.type&&e._current.id&&Ae.skey&&Be(e)},t=function(t){function n(){var t;return et(this,n),rt(t=Ze(this,n),"_current",{}),t.getAttribute("type")&&t.getAttribute("openid")?(e(t),t):Qe(t)}return it(n,t),nt(n,[{key:"attributeChangedCallback",value:function(){this._current.type===this.getAttribute("type")&&this._current.id===this.getAttribute("openid")&&this._current.corpid===this.getAttribute("corpid")||e(this)}}],[{key:"observedAttributes",get:function(){return["type","openid","corpid"]}}]),n}(ct(HTMLElement));customElements.define("ww-open-data",t)}catch(e){Et(e,"register custom element")}}}catch(re){e.captureException(re,"?")}}();
